<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="post">

   <select id="selectPostList" resultType="Post">
    SELECT *
    FROM (
        SELECT 
            ROWNUM AS rnum,
            p.post_key AS postKey,
            p.post_cd AS postCd,
            p.user_key AS userKey,
            u.user_nicknm AS userNickname,
            p.post_title AS postTitle,
            p.post_content AS postContent,
            p.post_view AS postViews,
            TO_CHAR(p.post_date, 'YYYY-MM-DD HH24:MI:SS') AS postDate,
            p.confirm_yn AS confirmYn,
            p.delete_yn AS deleteYn,
            p.delete_reason AS deleteReason,
            t.post_nm AS postCategory
        FROM 
            tbl_post p
        JOIN 
            tbl_user u ON p.user_key = u.user_key
        JOIN 
            tbl_post_type t ON p.post_cd = t.post_cd
        WHERE 
            p.delete_yn = 0
        ORDER BY 
            p.post_date DESC
    )
    WHERE rnum BETWEEN #{start} AND #{end}
</select>

    <!-- 전체 게시글 수 조회 -->
    <select id="selectPostCount" resultType="int">
        SELECT COUNT(*) FROM tbl_post WHERE delete_yn = 0
    </select>
    
    
    <select id="selectPosetKey"
			resultType="string">
			select seq_post.nextval from dual
	</select>
    
   <insert id="insertPost" parameterType="Post">
    INSERT INTO tbl_post (
        post_key,
        post_cd,
        user_key,
        post_title,
        post_content,
        post_date,
        post_view,
        confirm_yn,
        delete_yn
    ) VALUES (
        'po' || LPAD(seq_post.NEXTVAL, 4, '0'),
        #{postCd},
        #{userKey},
        #{postTitle},
        #{postContent},
        SYSDATE,
        0,
        'N',
        'N'
    )
</insert>
</mapper>


